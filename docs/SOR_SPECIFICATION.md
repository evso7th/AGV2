
# Техническая Спецификация: СОР (Система Обеспечения Разнообразия) v2.9

## 1. Концепция
СОР — это многоуровневая когнитивная надстройка над FractalMusicEngine, превращающая алгоритмическую генерацию в осмысленное музыкальное повествование. Система имитирует работу живого ансамбля, где каждый участник обладает памятью, слышит коллег и подчиняется драматическому сюжету.

---

## 2. Ключевые Технологии v2.9

### 2.1. Melodic Narration (Музыкальное Предложение)
*   **Механика**: Использование длинных музыкальных фраз (2-4 такта) в качестве атомарных единиц мелодии.
*   **Дыхание**: Логика "Вдоха" (soloistBusyUntilBar) — обязательные паузы между высказываниями.
*   **Динамика Выдоха**: Автоматическое снижение веса нот (`breathDecay`) к концу длинной фразы.

### 2.2. Spectral Hygiene (Анти-пчела)
*   **Алгоритм**: Динамическое управление LPF Cutoff в реальном времени.
*   **Логика**: Срез фильтра (800 - 5300 Гц) жестко связан с параметром `Fog` (Туман). Чем гуще туман, тем мягче и бархатистее звучит солист, избавляясь от зудящих ВЧ-гармоник.

### 2.3. Narrative Bass (Теневой Контрапункт)
*   **Синхронизация**: Бас отслеживает текущий Legacy Lick солиста.
*   **Исполнение**: В режиме темы бас играет упрощенный контур мелодии в суб-басовом регистре. В режиме паузы — возвращается к педали.

### 2.4. Global Sticky Orchestra & Staged Lottery
*   **Активация**: Динамическая жеребьевка состава в начале каждой сюиты.
*   **Липкость**: Инструмент сохраняет тембр до конца части, обеспечивая стабильность оркестра.

---

## 3. Ревизия Функций по Уровням

### Уровень 4: СОЧИНЕНИЕ (The Mind of SOR)
*   **The Chain of Suites**: Циклическая ротация MAIN -> BRIDGE -> PROMENADE.
*   **Diabolus in Musica**: Впрыск тритона (+6) в Dark-режимах для создания средневекового напряжения.
*   **Limbic Surge**: Акцент на малую сексту (+8) в минорных пиках при высоком Tension.
*   **Flute Quarantine**: Полная блокировка инструмента "flute" и автоматическая замена на "violin".

### Уровень 5: ТРАНСЛЯЦИЯ (Transmission)
*   **Harmony Audit**: Детальное логирование пути каждой ноты `[Bar] -> [Chord] -> [Sampler]`.
*   **BPM Sync**: Динамическая подстройка плотности нот под текущий темп DNA.

### Уровень 7: ИСПОЛНЕНИЕ (Execution)
*   **Imperial Percussion**: Использование томов Sonor Classix, резонансных киков и атмосферных райдов.
*   **Organic Detail Layer**: 15 независимых перкуссионных слоев (`perc-*`), всплывающих случайным образом.
*   **Imperial Balance**: Автоматические дефолты громкости (55/50/15/35) для жанра Ambient.

---
**Статус**: Система достигла промышленного стандарта "Имперского Звука". Глубина повествования и спектральная чистота подтверждены.
