
# Журнал Проекта "AuraGroove"

Этот документ является "живой спецификацией" и содержит историю ключевых решений и изменений, принятых в ходе разработки. Он служит "внешней памятью" для отслеживания эволюции проекта.

---

### ЗАПИСЬ: 2024-08-01

**СОБЫТИЕ: ОТКАТ ПРОЕКТА**

**ПРИЧИНА:**
Из-за неспособности ИИ-прототайпера решить критические проблемы, которые он сам создал (полное прекращение генерации партий `harmony` и `melody`, а также переполнение пула синтезаторов, вызывающее ошибки `No free voices`), было принято решение откатить кодовую базу.

**ДЕЙСТВИЕ:**
Выполнен откат проекта к версии `b1d824d`. Эта версия соответствует моменту, когда мы начали разбираться со спотыканиями при мутациях, но до внесения критических ошибок.

**КОНТЕКСТ:**
Непосредственно перед откатом был успешно выполнен План 192, интегрировавший в `SYSTEM_PROTOCOL.md` два новых закона:
- **Закон о Памяти Намерений (Комментирование):** Обязанность комментировать каждое значимое изменение.
- **Закон о Следе Действий (Ведение Журнала):** Обязанность вести и пополнять `project_history.md` при каждом изменении.

---

### ЗАПИСЬ: 2024-08-01 (Повторная)

**ПРОБЛЕМА:**
Партия `harmony` по-прежнему не генерировалась (`Harmony=0` в логах), что указывало на ошибку в логике генерации.

**ДИАГНОСТИКА:**
Анализ показал, что для генерации гармонии ошибочно использовалась функция `createAccompanimentAxiom`, которая создает события типа `accompaniment`. Для корректной работы необходима была функция, создающая события типа `harmony`.

**РЕШЕНИЕ:**
1. В `src/lib/music-theory.ts` была создана новая функция `createHarmonyAxiom`, которая является аналогом `createAccompanimentAxiom`, но корректно присваивает событиям тип `harmony`.
2. В `src/lib/fractal-music-engine.ts`, в методе `generateOneBar`, ошибочный вызов `createAccompanimentAxiom` был заменен на правильный `createHarmonyAxiom` внутри блока, отвечающего за генерацию гармонии.
**РЕЗУЛЬТАТ:** Партия `harmony` начала корректно генерироваться.

---

### ЗАПИСЬ: 2024-08-02

**ЗАДАЧА:**
Удлинить и сделать более музыкально осмысленными мелодические мотивы, генерируемые движком, а также добавить логирование для их отслеживания.

**РЕШЕНИЕ:**
1.  В функции `createMelodyMotif` (`src/lib/music-theory.ts`) базовый контур мелодии был расширен с 4 до 8 ступеней (`[0, 2, 4, 5, 7, 5, 4, 2]`), что создает более завершенную музыкальную фразу.
2.  В ту же функцию был добавлен `console.log`, который выводит в консоль последовательность MIDI-нот каждого нового сгенерированного мотива.
**РЕЗУЛЬТАТ:** Мелодические фразы стали более выразительными, а их структура стала видимой в логах для анализа.

---

### ЗАПИСЬ: 2024-08-03

**ЗАДАЧА:**
Сделать звучание мелодии более меланхоличным и глубоким.

**РЕШЕНИЕ:**
Понижена базовая октава для генерации мелодических мотивов. В функции `createMelodyMotif` (`src/lib/music-theory.ts`) значение константы `rootOctave` было изменено с `4` на `3`, что сместило все мелодические партии на октаву вниз.
**РЕЗУЛЬТАТ:** Мелодия приобрела более сдержанный и интроспективный характер.

---

### ЗАПИСЬ: 2024-08-04

**ПРОБЛЕМА:**
Полностью отсутствовали логи от Навигатора (`BlueprintNavigator`), что делало невозможным отслеживание смены частей (`INTRO`, `BUILD` и т.д.) и бандлов.

**ДИАГНОСТИКА:**
Анализ показал, что `BlueprintNavigator.tick()` корректно генерировал отладочное сообщение `logMessage`, но `FractalMusicEngine` в методе `evolve` игнорировал это сообщение и не выводил его в консоль.

**РЕШЕНИЕ:**
В метод `evolve()` файла `src/lib/fractal-music-engine.ts` добавлен блок кода, который проверяет наличие `logMessage` в объекте, возвращаемом Навигатором, и немедленно выводит его в консоль. Код был сопровожден комментарием, объясняющим его назначение.

**РЕЗУЛЬТАТ:** Логирование смены частей и бандлов полностью восстановлено.

---

### ЗАПИСЬ: 2024-08-05

**ПРОБЛЕМА:**
Басовая партия была монотонной и не развивалась, что делало общую картину утомляющей.

**ДИАГНОСТИКА:**
Анализ кода показал, что движок генерировал одну и ту же басовую фразу на протяжении всей композиции.

**РЕШЕНИЕ:**
1.  В `src/lib/music-theory.ts` были созданы две новые функции:
    *   `generateAmbientBassPhrase` для генерации осмысленных, медленных басовых фраз.
    *   `mutateBassPhrase` для внесения тонких изменений в существующие фразы.
2.  В `src/lib/fractal-music-engine.ts` была внедрена система "библиотеки басовых фраз". Движок теперь хранит 4 фразы, циклически проигрывает их и с определенной вероятностью мутирует одну из них каждые 4 такта.

**РЕЗУЛЬТАТ:** Бас стал "живым" и "дышащим". Он сохраняет гармоническую основу, но при этом постоянно развивается, что делает музыку более интересной и менее предсказуемой.

---

### ЗАПИСЬ: 2024-08-06

**ЗАДАЧА:**
Добавить диагностическое логирование для генерации и мутации басовых фраз для лучшего понимания их эволюции.

**РЕШЕНИЕ:**
В файл `src/lib/music-theory.ts` были добавлены `console.log`:
1.  В `generateAmbientBassPhrase` добавлен лог, выводящий MIDI-ноты каждой новой сгенерированной фразы (аксиомы).
2.  В `mutateBassPhrase` добавлен лог, который показывает тип примененной мутации и получившуюся в результате фразу.

**РЕЗУЛЬТАТ:** Консоль теперь предоставляет полную картину эволюции басовой партии, от создания до ее трансформаций, что значительно упрощает отладку и дальнейшую настройку.
