# Журнал Проекта "AuraGroove"

Этот документ является "живой спецификацией" и содержит историю ключевых решений и изменений, принятых в ходе разработки. Он служит "внешней памятью" для отслеживания эволюции проекта.

---

### ЗАПИСЬ: 2024-08-01

**СОБЫТИЕ: ОТКАТ ПРОЕКТА**

**ПРИЧИНА:**
Из-за неспособности ИИ-прототайпера решить критические проблемы, которые он сам создал (полное прекращение генерации партий `harmony` и `melody`, а также переполнение пула синтезаторов, вызывающее ошибки `No free voices`), было принято решение откатить кодовую базу.

**ДЕЙСТВИЕ:**
Выполнен откат проекта к версии `b1d824d`. Эта версия соответствует моменту, когда мы начали разбираться со спотыканиями при мутациях, но до внесения критических ошибок.

**КОНТЕКСТ:**
Непосредственно перед откатом был успешно выполнен План 192, интегрировавший в `SYSTEM_PROTOCOL.md` два новых закона:
- **Закон о Памяти Намерений (Комментирование):** Обязанность комментировать каждое значимое изменение в коде.
- **Закон о Следе Действий (Ведение Журнала):** Обязанность вести и пополнять `project_history.md` при каждом изменении.

---

### ЗАПИСЬ: 2024-08-01 (Повторная)

**ПРОБЛЕМА:**
Партия `harmony` по-прежнему не генерируется (`Harmony=0` в логах), что указывает на ошибку в логике генерации.

**ДИАГНОСТИКА:**
Анализ показал, что для генерации гармонии ошибочно использовалась функция `createAccompanimentAxiom`, которая создает события типа `accompaniment`. Для корректной работы необходима была функция, создающая события типа `harmony`.

**РЕШЕНИЕ:**
1. В `src/lib/music-theory.ts` была создана новая функция `createHarmonyAxiom`, которая является аналогом `createAccompanimentAxiom`, но корректно присваивает событиям тип `harmony`.
2. В `src/lib/fractal-music-engine.ts`, в методе `generateOneBar`, ошибочный вызов `createAccompanimentAxiom` был заменен на правильный `createHarmonyAxiom` внутри блока, отвечающего за генерацию гармонии.
**РЕЗУЛЬТАТ:** Партия `harmony` начала корректно генерироваться.

---

### ЗАПИСЬ: 2024-08-02

**ЗАДАЧА:**
Удлинить и сделать более музыкально осмысленными мелодические мотивы, генерируемые движком, а также добавить логирование для их отслеживания.

**РЕШЕНИЕ:**
1.  В функции `createMelodyMotif` (`src/lib/music-theory.ts`) базовый контур мелодии был расширен с 4 до 8 ступеней (`[0, 2, 4, 5, 7, 5, 4, 2]`), что создает более завершенную музыкальную фразу.
2.  В ту же функцию был добавлен `console.log`, который выводит в консоль последовательность MIDI-нот каждого нового сгенерированного мотива.
**РЕЗУЛЬТАТ:** Мелодические фразы стали более выразительными, а их структура стала видимой в логах для анализа.
