
# Журнал Проекта "AuraGroove"

---

### ЗАПИСЬ: 2024-12-04 (План №251: «STAGNATION DETECTOR STABILIZATION»)

**ПРОБЛЕМА:**
Страж зацикливания (Novelty Guard) не срабатывал на явно слышимых циклах Мелодии и Пианиста. Причина — избыточная точность хэширования времени (секунды с плавающей точкой), которая делала хэши уникальными из-за микро-джиттера гуманизации (±15-25 мс).

**РЕШЕНИЕ:**
1. **Tick-Based Hashing**: Хэширование времени событий переведено с секунд на квантованные тики (1/3 доли). Это позволяет детектору игнорировать "человеческие" неточности тайминга и видеть структуру фразы.
2. **Unified Ensemble Detection**: Хэш теперь включает в себя совместную форму Солиста и Пианиста, предотвращая коллективную стагнацию ансамбля.
3. **Chaos Injection**: При обнаружении 3-х повторов подряд СОР теперь не просто сбрасывает аксиому, а принудительно вызывает эволюцию Л-системы с максимальным коэффициентом случайности.
4. **Telemetry**: Добавлены яркие логи в консоль при обнаружении стагнации для визуального контроля работы стража.

---

### ЗАПИСЬ: 2024-12-04 (План №250: «FIRESTORE PERMISSIONS ULTIMATUM»)

**ПРОБЛЕМА:**
Несмотря на открытые правила, анонимная запись через `addDoc` приводила к ошибке `Missing or insufficient permissions`. В логах путь запроса отображался без ID документа, что препятствовало срабатыванию правил.

**РЕШЕНИЕ:**
1. **Deterministic Writing**: Функция `saveMasterpiece` переведена на использование `setDoc` с предварительной генерацией ID на клиенте через `doc(collection(...))`. Это гарантирует наличие ID в пути запроса.
2. **Rule Generalization**: В `firestore.rules` путь для `masterpieces` изменен на `{document=**}` для охвата любых вложенных структур и обеспечения стопроцентного совпадения.
3. **Purity**: Удалены все потенциальные причины блокировки анонимной записи.

---
