# Журнал Проекта "AuraGroove"

---

### ЗАПИСЬ: 2024-12-04 (План №156: "Narrative Vitality & Bass Floor")

**ПРОБЛЕМА:**
1. Интро было слишком пустым из-за нехватки энергетического бюджета для соло.
2. Выбирались технические "Outro" планы как основной сюжет.
3. Бас уходил в инфразвук (ниже 20 Гц) при низких тониках.
4. В карте сэмплов гитарных аккордов присутствовали нежелательные Telecaster сэмплы.

**ПРИЧИНА:**
1. Порог базового бюджета (40) был ниже стоимости соло (50).
2. Отсутствие фильтрации планов при выборе повествовательной линии.
3. Прямое вычитание октавы без проверки слышимого диапазона.
4. Избыточные записи в `samples.ts`.

**РЕШЕНИЕ:**
1. **Budget Floor**: Базовый бюджет поднят до 60. Теперь соло гарантированно вступает с 0-го такта.
2. **Story Filter**: Из пула выбора планов исключены все ID, содержащие "OUTRO".
3. **Sub-bass Protection**: Внедрен порог MIDI 24. Все ноты ниже автоматически транспонируются вверх.
4. **Sample Cleanup**: Из `ACOUSTIC_GUITAR_CHORD_SAMPLES` удалены все ссылки на Telecaster.

**ВЫВОД:**
Ансамбль обрел "волю к жизни" в интро, бас стал физически слышимым, а библиотека сэмплов очищена.

---

### ЗАПИСЬ: 2024-12-04 (План №155: "Energy Budget Final Polish")

**ПРОБЛЕМА:**
Критическая ошибка `ReferenceError: currentEnergy is not defined` в `blues-brain.ts`.

**ПРИЧИНА:**
Опечатка в коде метода `generateBar`: переменная `currentEnergy` использовалась вместо инициализированной `consumedEnergy`.

**РЕШЕНИЕ:**
1. Переменная переименована в `consumedEnergy` по всему файлу.
2. Проведен аудит всех расчетов баллов.
3. Проверены импорты типов для устранения предупреждений компилятора.

**ВЫВОД:**
Фаза 1 СОР (Биосфера) полностью стабилизирована и готова к работе.

---

### ЗАПИСЬ: 2024-12-04 (План №154: "Dramatic Expansion & First Resonance")

**ПРОБЛЕМА:**
Сюжетная линия сюиты была слишком плоской (малый диапазон напряжения), а музыканты играли изолированно, создавая риск хаотичного наслоения звуков ("каши").

**ПРИЧИНА:**
1. Математика MusiNum в `generateTensionMap` давала средние значения около 0.5 без резких перепадов.
2. Отсутствие механизма обратной связи между тактами (Resonance Buffer).
3. Отсутствие лимитов на одновременную активность инструментов.

**РЕШЕНИЕ:**
1. **Dramatic Contrast**: Внедрена S-образная функция контраста для карты напряжения. Теперь сюжет имеет четкие зоны "шепота" (tension < 0.2) и "крика" (tension > 0.8).
2. **Resonance Buffer**: В `FractalMusicEngine` добавлен буфер `lastEvents`. Теперь Мозг "слышит", что играли коллеги в прошлом такте.
3. **Neighbor Listening**: 
    - Гитарист акцентирует атаку, если барабанщик только что сделал филл.
    - Басист переходит на волкинг, если гитарист взял "кричащую" высокую ноту.
4. **Energy Budget**: Реализована система баллов. Каждый инструмент "стоит" определенную энергию. Если бюджет такта (зависящий от напряжения) превышен, второстепенные партии упрощаются или отключаются.

**ВЫВОД:**
Сюита обрела драматургическую глубину и ансамблевую реактивность. Риск "каши" устранен на уровне оркестровки.

---
