# Журнал Проекта "AuraGroove"

Этот документ является "живой спецификацией" и содержит историю ключевых решений и изменений, принятых в ходе разработки. Он служит "внешней памятью" для отслеживания эволюции проекта.

---

### ЗАПИСЬ: 2024-08-01

**СОБЫТИЕ: ОТКАТ ПРОЕКТА**

**ПРИЧИНА:**
Из-за неспособности ИИ-прототайпера решить критические проблемы, которые он сам создал (полное прекращение генерации партий `harmony` и `melody`, а также переполнение пула синтезаторов, вызывающее ошибки `No free voices`), было принято решение откатить кодовую базу.

**ДЕЙСТВИЕ:**
Выполнен откат проекта к версии `b1d824d`. Эта версия соответствует моменту, когда мы начали разбираться со спотыканиями при мутациях, но до внесения критических ошибок.

**КОНТЕКСТ:**
Непосредственно перед откатом был успешно выполнен План 192, интегрировавший в `SYSTEM_PROTOCOL.md` два новых закона:
- **Закон о Памяти Намерений (Комментирование):** Обязанность комментировать каждое значимое изменение в коде.
- **Закон о Следе Действий (Ведение Журнала):** Обязанность вести и пополнять `project_history.md` при каждом изменении.

Эти правила остаются в силе и будут применяться ко всем последующим действиям.

---

### ЗАПИСЬ: 2024-07-31

**ПРОБЛЕМА:**
После серии рефакторингов и исправлений, звуковые слои `harmony` и `melody` перестали воспроизводиться, несмотря на то, что в блюпринтах их проигрывание было разрешено.

**ДИАГНОСТИКА:**
С помощью серии диагностических `console.log` в `FractalMusicEngine`, `ambient.worker.ts` и `audio-engine-context.tsx` было установлено, что проблема возникает на самом первом этапе — генерации. `FractalMusicEngine` не создавал события для этих партий.

**ПРИЧИНА:**
В ходе одного из предыдущих рефакторингов были непреднамеренно удалены строки кода, отвечающие за вызов функций `createAccompanimentAxiom` (для `harmony`) и `createMelodyMotif` (для `melody`) внутри метода `generateOneBar` в `fractal-music-engine.ts`. Движок "знал", что нужно играть, но команда "сочинить" не отдавалась.

**РЕШЕНИЕ:**
Восстановлены недостающие вызовы функций в `src/lib/fractal-music-engine.ts` с добавлением подробных комментариев, объясняющих назначение каждого блока кода, чтобы предотвратить подобные случайные удаления в будущем.

---

### ЗАПИСЬ: 2024-08-01 (Повторная)

**ПРОБЛЕМА:**
Партия `harmony` по-прежнему не генерируется (`Harmony=0` в логах), что указывает на ошибку в логике генерации.

**ПРИЧИНА:**
Анализ показал, что для генерации гармонии ошибочно использовалась функция `createAccompanimentAxiom`, которая создает события типа `accompaniment`. Для корректной работы необходима была функция, создающая события типа `harmony`.

**РЕШЕНИЕ:**
1. В `src/lib/music-theory.ts` была создана новая функция `createHarmonyAxiom`, которая является аналогом `createAccompanimentAxiom`, но корректно присваивает событиям тип `harmony`.
2. В `src/lib/fractal-music-engine.ts`, в методе `generateOneBar`, ошибочный вызов `createAccompanimentAxiom` был заменен на правильный `createHarmonyAxiom` внутри блока, отвечающего за генерацию гармонии.
